%global __brp_check_rpaths %{nil}
%define with_python2 %{?_with_python2:1}%{!?_with_python2:0}

Summary: OpenTestPoint IPTraffic Probe
Name: opentestpoint-probe-iptraffic
Version: @VERSION@
Release: 1%{?dist}
License: BSD
Group: Applications/System
URL: http://adjacentlink.com
Source0: %{name}-%{version}.tar.gz
BuildRoot: %{_tmppath}/%{name}-%{version}-%{release}-root
BuildRequires: libxml2-devel protobuf-devel
Vendor: Adjacent Link LLC

%define with_old_depends 0%{?el7}

%if 0%{?with_python2}
%if 0%{?with_old_depends}
Requires: libxml2 protobuf opentestpoint python-opentestpoint
BuildRequires: python
%define use_python_sitelib %{python_sitelib}
%else
Requires: libxml2 protobuf opentestpoint python2-opentestpoint
BuildRequires: python2
%define use_python_sitelib %{python2_sitelib}
%endif
%else
Requires: libxml2 protobuf opentestpoint python3-opentestpoint
BuildRequires: python3
%define use_python_sitelib %{python3_sitelib}
%endif

%description
OpenTestPoint IPTraffic Probe

%package protos
Summary: OpenTestPoint IPTraffic Probe protobuf specifications
Group: Applications/System
BuildArch: noarch

%description protos
OpenTestPoint IPTraffic Probe protobuf specifications

%global debug_package %{nil}

%prep
%setup -q

%build
%if 0%{?with_python2}
%configure --with-python2
%else
%configure
%endif
make

%install
make DESTDIR=${RPM_BUILD_ROOT} install
find ${RPM_BUILD_ROOT} -name '*.a' -exec rm '{}'  \;
find ${RPM_BUILD_ROOT} -name '*.la' -exec rm '{}' \;

%clean
rm -rf $RPM_BUILD_ROOT

%post
/sbin/ldconfig

%postun
/sbin/ldconfig

%files
%defattr(-,root,root,-)
%{_libdir}/*
%{use_python_sitelib}/*

%doc AUTHORS
%doc COPYING
%doc NEWS
%doc README
%doc INSTALL

%files protos
%defattr(-,root,root,-)
%doc %{_datadir}/opentestpoint-probe-iptraffic/proto/*.proto


